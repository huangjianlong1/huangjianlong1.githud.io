<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>项目管理表</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .controls {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <select id="filterPhase" onchange="filterRows()">
            <option value="">请选择阶段</option>
            <option value="设计">设计</option>
            <option value="开发">开发</option>
            <option value="测试">测试</option>
            <option value="部署">部署</option>
        </select>
        <button onclick="exportToCSV()">导出为CSV</button>
    </div>
    <!-- 其他HTML代码保持不变 -->
    <table id="projectTable">
        <thead>
            <tr>
                <th>项目编号</th>
                <th>合同编号</th>
                <th>合同名称</th>
                <th>项目阶段</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- 行数据 -->
        </tbody>
    </table>

    <script>
        // 筛选功能
        function filterRows() {
            const phase = document.getElementById('filterPhase').value;
            const rows = document.getElementById('tableBody').getElementsByTagName('tr');

            for (let row of rows) {
                if (phase === '') {
                    row.style.display = '';
                } else {
                    const projectPhase = row.cells[3].textContent;
                    row.style.display = projectPhase === phase ? '' : 'none';
                }
            }
        }

        // 导出CSV功能
        function exportToCSV() {
            const table = document.getElementById('projectTable');
            const rows = table.getElementsByTagName('tr');

            let csvContent = '项目编号,合同编号,合同名称,项目阶段\n';

            for (let row of rows) {
                if (row.style.display === 'none') continue; // 跳过隐藏的行
                const cells = row.getElementsByTagName('td');
                if (cells.length > 0) { // 忽略表头
                    let line = '';
                    for (let i = 0; i < cells.length - 1; i++) { // 忽略操作列
                        line += '"' + cells[i].textContent.replace(/"/g, '""') + '",';
                    }
                    csvContent += line.slice(0, -1) + '\n'; // 去除最后一个逗号并换行
                }
            }

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'project_data.csv';
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // 原有JavaScript代码保持不变
    </script>
</body>
</html>
