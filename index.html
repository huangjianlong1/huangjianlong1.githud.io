<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>项目管理表</title>
<style>
table {
width: 100%;
border-collapse: collapse;
}
th, td {
padding: 8px;
text-align: left;
border-bottom: 1px solid #ddd;
}
th {
cursor: pointer;
}
.export-btn {
margin-bottom: 10px;
}
</style>
</head>
<body>
<form id="filterForm">
<div style="margin-bottom: 10px;">
<label>项目阶段:</label>
<select id="phaseFilter" onchange="applyFilters()">
<option value="">全部</option>
<option value="签合同">签合同</option>
<option value="施工中">施工中</option>
<option value="完工入库">完工入库</option>
<option value="结算完成">结算完成</option>
</select>

<label>开始日期:</label>
<input type="date" id="startDateFilter" onchange="applyFilters()">

<label>结束日期:</label>
<input type="date" id="endDateFilter" onchange="applyFilters()">
</div>
</form>

<button class="export-btn" onclick="exportToCSV()">导出为 CSV</button>

<table>
<thead>
<tr>
<th onclick="sortTable('number')">项目编号</th>
<th onclick="sortTable('contractNumber')">合同号</th>
<th onclick="sortTable('name')">项目名称</th>
<th onclick="sortTable('amount')">金额（万元）</th>
<th onclick="sortTable('phase')">阶段</th>
<th onclick="sortTable('startDate')">开始日期</th>
<th onclick="sortTable('endDate')">结束日期</th>
<th>操作</th>
</tr>
</thead>
<tbody id="tableBody">
<!-- 表格内容由 JavaScript 生成 -->
</tbody>
</table>

<form id="addForm" onsubmit="return addProject()">
<div style="margin-top: 10px;">
<label>项目编号:</label>
<input type="text" id="projectNumber" required><br>

<label>合同号:</label>
<input type="text" id="contractNumber" required><br>

<label>项目名称:</label>
<input type="text" id="projectName" required><br>

<label>金额（万元）:</label>
<input type="number" id="amount" step="0.1" required><br>

<label>阶段:</label>
<select id="phase">
<option value="签合同">签合同</option>
<option value="施工中">施工中</option>
<option value="完工入库">完工入库</option>
<option value="结算完成">结算完成</option>
</select><br>

<label>开始日期:</label>
<input type="date" id="startDate" required><br>

<label>结束日期:</label>
<input type="date" id="endDate" required><br>

<button type="submit">添加项目</button>
</div>
</form>

<script>
let projects = [];
let currentSortColumn = '';
let isAscending = true;

// 排序函数
function sortTable(column) {
if (column === currentSortColumn) {
isAscending = !isAscending;
} else {
currentSortColumn = column;
isAscending = true;
}
renderTable();
}

// 筛选函数
function applyFilters() {
renderTable();
}

// 导出为 CSV
function exportToCSV() {
const csvContent = [
['项目编号', '合同号', '项目名称', '金额（万元）', '阶段', '开始日期', '结束日期'].join(','),
...projects.map(project => [
project.number,
project.contractNumber,
project.name,
project.amount,
project.phase,
project.startDate,
project.endDate
].join(','))
].join('\n');

const blob = new Blob([csvContent], { type: 'text/csv' });
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = 'projects.csv';
a.click();
window.URL.revokeObjectURL(url);
}

// 原有函数保持不变...
function addProject() {
const project = {
number: document.getElementById('projectNumber').value,
contractNumber: document.getElementById('contractNumber').value,
name: document.getElementById('projectName').value,
amount: parseFloat(document.getElementById('amount').value),
phase: document.getElementById('phase').value,
startDate: document.getElementById('startDate').value,
endDate: document.getElementById('endDate').value
};

projects.push(project);
renderTable();
return false;
}

function renderTable() {
const filteredProjects = getFilteredProjects();

const tbody = document.getElementById('tableBody');
tbody.innerHTML = '';

if (currentSortColumn) {
filteredProjects.sort((a, b) => {
let comparison = 0;
if (a[currentSortColumn] < b[currentSortColumn]) {
comparison = -1;
} else if (a[currentSortColumn] > b[currentSortColumn]) {
comparison = 1;
}
return isAscending ? comparison : -comparison;
});
}

filteredProjects.forEach(project => {
const row = document.createElement('tr');
row.innerHTML = `
<td>${project.number}</td>
<td>${project.contractNumber}</td>
<td>${project.name}</td>
<td>${project.amount.toFixed(1)}</td>
<td>${project.phase}</td>
<td>${project.startDate}</td>
<td>${project.endDate}</td>
<td>
<button onclick="editProject('${project.number}')">编辑</button>
<button onclick="deleteProject('${project.number}')">删除</button>
</td>
`;
tbody.appendChild(row);
});
}

function getFilteredProjects() {
const phaseFilter = document.getElementById('phase').value;
const startDateFilter = document.getElementById('startDate').value;
const endDateFilter = document.getElementById('endDate').value;

return projects.filter(project => {
const matchesPhase = phaseFilter === '全部' || project.phase === phaseFilter;
const matchesStartDate = !startDateFilter || project.startDate >= startDateFilter;
const matchesEndDate = !endDateFilter || project.endDate <= endDateFilter;

return matchesPhase && matchesStartDate && matchesEndDate;
});
}

// 原有函数保持不变...
function editProject(number) {
const project = projects.find(p => p.number === number);
if (project) {
document.getElementById('projectNumber').value = project.number;
document.getElementById('contractNumber').value = project.contractNumber;
document.getElementById('projectName').value = project.name;
document.getElementById('amount').value = project.amount;
document.getElementById('phase').value = project.phase;
document.getElementById('startDate').value = project.startDate;
document.getElementById('endDate').value = project.endDate;
}
}

function deleteProject(number) {
projects = projects.filter(p => p.number !== number);
renderTable();
}

// 初始化
renderTable();
</script>
</body>
</html>
</think>
