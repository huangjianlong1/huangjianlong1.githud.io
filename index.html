<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>项目请款管理系统</title>
    <style>
        /* 新增统计面板样式 */
        .dashboard {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* 新增筛选工具栏 */
        .filter-toolbar {
            margin: 20px 0;
            display: flex;
            gap: 15px;
        }
        .filter-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
    </style>
</head>
<body>
    <!-- 新增统计面板 -->
    <div class="dashboard">
        <div class="stat-item">
            <h3>总项目数</h3>
            <span id="totalProjects">0</span>
        </div>
        <div class="stat-item">
            <h3>总金额</h3>
            <span id="totalAmount">0</span>
        </div>
        <div class="stat-item">
            <h3>平均进度</h3>
            <span id="avgProgress">0%</span>
        </div>
        <div class="stat-item">
            <h3>本月新增</h3>
            <span id="monthlyNew">0</span>
        </div>
    </div>

    <!-- 新增筛选工具栏 -->
    <div class="filter-toolbar">
        <input type="text" class="filter-input" placeholder="输入项目名称或合同编号筛选" id="searchInput">
        <button onclick="loadData()">搜索</button>
        <button onclick="clearFilters()" class="secondary">重置</button>
    </div>

    <table id="projectTable">
        <!-- 表头保持不变 -->
        <tbody id="tableBody">
            <!-- 新增删除按钮列 -->
            <script>
                async function loadData() {
                    try {
                        const search = document.getElementById('searchInput').value;
                        const response = await fetch(`/api/requests?filterByFormula=${encodeURIComponent(`SEARCH("${search}", {项目名称}) || SEARCH("${search}", {合同编号})`)}`);
                        
                        // ... 数据加载和渲染逻辑 ...
                    } catch (error) {
                        alert('数据加载失败: ' + error.message);
                    }
                }

                // 新增删除功能
                async function deleteRecord(recordId) {
                    if (confirm('确定要删除这条记录吗？')) {
                        try {
                            const response = await fetch(`/api/requests/${recordId}`, {
                                method: 'DELETE'
                            });
                            
                            if (response.ok) {
                                loadData(); // 刷新数据
                            }
                        } catch (error) {
                            alert('删除失败: ' + error.message);
                        }
                    }
                }

                // 新增统计计算
                function updateStatistics(data) {
                    document.getElementById('totalProjects').textContent = data.length;
                    
                    const totalAmount = data.reduce((sum, item) => 
                        sum + (Number(item.zongbaoqingkuanjinger) || 0), 0);
                    document.getElementById('totalAmount').textContent = totalAmount.toLocaleString();
                    
                    const avgProgress = data.length ? 
                        data.reduce((sum, item) => sum + (item.wanchengjingdu || 0), 0) / data.length :
                        0;
                    document.getElementById('avgProgress').textContent = 
                        `${Math.round(avgProgress * 100)}%`;
                }
            </script>
        </tbody>
    </table>
</body>
</html>
